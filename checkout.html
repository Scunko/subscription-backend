<script>
  // LIVE publishable key
  const stripe = Stripe("pk_live_51SiglOELCSEmD9SiTnTGv5dVaWEj23wysxfuKzrSKVoagNopytXWamT8IiBdWB90zwrim9aA5K67rwsUSZE0upIj00r0bIs5dG");

  const elements = stripe.elements({
    appearance: {
      theme: "night",
      variables: {
        colorText: "#ffffff",
        colorTextPlaceholder: "#94a3b8",
        colorBackground: "#020617",
        colorDanger: "#f87171",
        fontSizeBase: "16px"
      }
    }
  });

  const card = elements.create("card", {
    style: {
      base: {
        color: "#ffffff",
        fontSize: "16px",
        "::placeholder": {
          color: "#94a3b8"
        }
      },
      invalid: {
        color: "#f87171"
      }
    }
  });

  card.mount("#card-element");

  // LIVE price ID (must be created in LIVE mode)
  const PRICE_ID = "price_1Sih3YELCSEmD9SiaiKG67Kv";

  // ✅ FIXED: button ID now matches HTML
  document.getElementById("subscribe").onclick = async () => {
    const email = document.getElementById("email").value;
    const errorDiv = document.getElementById("error");

    errorDiv.textContent = "";

    if (!email) {
      errorDiv.textContent = "Please enter an email.";
      return;
    }

    const { paymentMethod, error } = await stripe.createPaymentMethod({
      type: "card",
      card,
      billing_details: { email }
    });

    if (error) {
      errorDiv.textContent = error.message;
      return;
    }

    const res = await fetch("/api/create-subscription", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        paymentMethodId: paymentMethod.id,
        email: email,
        priceId: PRICE_ID
      })
    });

    const data = await res.json();

    if (!data.clientSecret) {
      errorDiv.textContent = data.error || "Server error";
      return;
    }

    const result = await stripe.confirmCardPayment(data.clientSecret);

    if (result.error) {
      errorDiv.textContent = result.error.message;
    } else {
      alert("✅ Subscription active");
    }
  };
</script>
