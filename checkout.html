<script>
  const stripe = Stripe("pk_test_51SiglOELCSEmD9SirozxZHPwPJkSWh62LQdeYjZ3lhgGUNrNBKJbOs1VlNuo0WE5PeZjEPFmHzslGVrOvKQNk87M00HWIgJNl4");

  const elements = stripe.elements();

  // ðŸ”¥ THIS IS THE IMPORTANT PART
  const card = elements.create("card", {
    style: {
      base: {
        color: "#ffffff",               // TEXT COLOR (FIXES ZIP/CVC)
        fontFamily: "Inter, system-ui, sans-serif",
        fontSize: "16px",
        "::placeholder": {
          color: "#94a3b8"
        },
        iconColor: "#94a3b8",
        caretColor: "#22c55e"
      },
      invalid: {
        color: "#f87171",
        iconColor: "#f87171"
      }
    }
  });

  card.mount("#card-element");

  const PRICE_ID = "price_1SkgHyELCSEmD9SiEn4rkCAl";

  document.getElementById("subscribe").onclick = async () => {
    const email = document.getElementById("email").value;
    const errorDiv = document.getElementById("error");

    errorDiv.textContent = "";

    const { paymentMethod, error } = await stripe.createPaymentMethod({
      type: "card",
      card,
      billing_details: { email }
    });

    if (error) {
      errorDiv.textContent = error.message;
      return;
    }

    const res = await fetch("/api/create-subscription", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        paymentMethodId: paymentMethod.id,
        email,
        priceId: PRICE_ID
      })
    });

    const data = await res.json();

    if (!data.clientSecret) {
      errorDiv.textContent = data.error || "Server error";
      return;
    }

    const confirm = await stripe.confirmCardPayment(data.clientSecret);

    if (confirm.error) {
      errorDiv.textContent = confirm.error.message;
    } else {
      alert("Subscription active!");
    }
  };
</script>
